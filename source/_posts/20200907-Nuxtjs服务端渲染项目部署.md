---
title: 'Nuxtjs服务端渲染项目部署'
categories:
- 运维
tags: 
- Nuxtjs
- 项目部署
description: 记录Nuxtjs服务端项目部署
cover: https://blog-misaka1033.oss-cn-beijing.aliyuncs.com/blog/images/1599308368190.webp
---
# 概要
## 服务端渲染
## Nuxtjs

# centos中安装nodejs
## 下载

打开nodejs[下载页面](https://nodejs.org/en/download/),，下载安装包
* source code 是源码，没有编译，需要自己去编译，速度慢，需要安装升级额外的依赖，暂不尝试
* 选择了 Linux Binaries(x64) 64-bit,是已经编译好的文件

![nodejs下载](https://blog-misaka1033.oss-cn-beijing.aliyuncs.com/blog/images/微信截图_20200908005435.webp)

使用xftp，将安装包放入/usr/local/src/下
在centos中，也可以直接在linux中下载，运行如下指令即可。两种方法，下载的都很慢就是了。
``` bash
cd /usr/local/src/
wget https://nodejs.org/dist/v12.18.3/node-v12.18.3-linux-x64.tar.xz
```
## 解压
解压并重命名下
``` bash
cd /usr/local/src/
tar -xvf node-v12.18.3-linux-x64.tar.xz
mv node-v12.18.3-linux-x64 nodejs
```
## 配置软链接
目的是为了让nodejs能在全局使用，如果是在/usr/local/bin/下，则不需要此操作。
下面的指令是将node和npm指令可执行文件链接到/usr/local/bin/目录下，相当于系统变量

``` bash
ln -s /usr/local/src/nodejs/bin/node /usr/local/bin/
ln -s /usr/local/src/nodejs/bin/npm /usr/local/bin/
ln -s /usr/local/src/nodejs/bin/npx /usr/local/bin/
```

## 检查

``` bash
node -v
npm -version
```
## 配置淘宝源

``` bash
npm install -g cnpm --registry=https://registry.npm.taobao.org
ln -s /usr/local/src/nodejs/bin/cnpm /usr/local/bin/
```

# nginx配置
创建一个server
```
upstream nuxtserver1 {
	server localhost:3000;
}
server {
       listen       80;
        server_name  120.79.203.16;
        location / {
	     proxy_pass  http://nuxtserver1;
	    index	index.html   index.htm;
        }
}
```
注意
* server_name可以配置成域名，如果没有域名，则配置服务器公网ip
* upstream的端口号，应该和nuxtjs启动的端口号相同

# 构建Nuxtjs项目
## 工程
``` bash
npx create-nuxt-app <项目名>
```
## 编译
``` bash
npm run build
```
## 拷贝
在服务器建立文件夹/web/nuxt/server，将编译好的文件，全部迁移到此目录下
* .nuxt
* static
* nuxt.config.js
* package.json

## 依赖安装
进入/web/nuxt/server文件夹，运行 cnpm install --production

## 启动
运行指令，启动服务
``` bash
npm run start
```

## 访问
此时，请求nginx的公网ip，即可以被代理到服务器本地localhost:3000，获取页面

![8cfeb3122ddc53dafb3129092b3bfaf](https://blog-misaka1033.oss-cn-beijing.aliyuncs.com/blog/images/8cfeb3122ddc53dafb3129092b3bfaf.webp)

# 安装使用pm2

## 安装

``` bash
cnpm install pm2 -g
ln -s /usr/local/src/nodejs/bin/pm2 /usr/local/bin/
pm2 --version
```
## pm2启动配置文件
在工程目录下建立pm2.json文件
``` json
[
    {
        "name": "testnuxt",
        "script": "npm run start"
    }
]
```
## 启用
``` bash
cd /web/nuxt/server/
pm2 start pm2.json
```
![启动完成](https://blog-misaka1033.oss-cn-beijing.aliyuncs.com/blog/images/微信截图_20200908011037.webp)

## 监听文件变化自动重启

## 可视化
https://keymetrics.pm2.io/

# 其他
## 修改端口号
nuxt.config.js
``` javascript
export default {
    server: {
        port: 8000,
        host: '0.0.0.0'
    }
}

```

package.json
``` json
"scripts": {
    "dev": "nuxt --hostname 0.0.0.0 --port 3008",
},
```
